units real
atom_style full 
boundary p p p

read_data 1H2O
replicate 8 8 8

pair_style lj/cut/tip4p/long 1 2 1 1 0.1546 9.5
kspace_style pppm/tip4p 1.0e-5

bond_style harmonic
angle_style harmonic

pair_coeff 1 1 0.18521 3.1589 #O-O
pair_coeff 1 2 0.0 0.0 #O-H
pair_coeff 2 2 0.0 1.0 #H-H
pair_modify tail yes

bond_coeff 1 1000.0 0.9572 #O-H
angle_coeff 1 100.0 104.52 #H-O-H

group gH2O type 1 2
group gO type 1

neighbor 3.0 bin
neigh_modify delay 10 every 2 check yes

# minimize 1.0e-4 1.0e-6 1000 10000
reset_timestep 0

variable massAll equal mass(all)/6.022e23
variable volCm3 equal vol*1.0e-24
variable density_sys equal v_massAll/v_volCm3
variable tmp equal temp

timestep 2.0

thermo 1000
thermo_style custom step temp vol etotal pe lx v_density_sys
thermo_modify flush yes

velocity all create 350.0 12345 dist gaussian
fix 1 gH2O shake 1.0e-4 100 0 b 1 a 1
fix fnpt all npt temp 350.0 350.0 1000.0 iso 0.9869 0.9869 5000.0

# run  500000 # 1ns
# unfix fnpt

# velocity all scale 200.0
# fix fnpt all npt temp 200.0 200.0 1000.0 iso 0.9869 0.9869 5000.0

# dump restart_dump gH2O custom 5000000 dump_H2O_restart.lammpstrj id type xu yu zu
# run 15000000 # 30ns

# fix fdensity gH2O ave/time 250 80 20000 v_density_sys file tmp.rho # 间隔0.5ps采样，总时间为40ps

dump dH2O gH2O custom 5000 dump_H2O.lammpstrj id type xu yu zu # 间隔10ps采样
dump_modify dH2O sort id

run 100000000 # 200ns
write_restart final_200K_1atm_tip4p.restart